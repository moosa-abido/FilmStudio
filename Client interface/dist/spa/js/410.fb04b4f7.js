"use strict";(globalThis["webpackChunkfilm_api"]=globalThis["webpackChunkfilm_api"]||[]).push([[410],{3682:(e,l,a)=>{a.d(l,{t:()=>o});var t=a(2502);const o=(0,t.Q_)("auth",{state:()=>({user:null}),getters:{loggedInUser(){return null==this.user&&(this.user=JSON.parse(localStorage.getItem("user"))),this.user}},actions:{setUser(e){this.user=e,localStorage.setItem("user",JSON.stringify(e))},resetUser(){this.user=null,localStorage.removeItem("user")}}})},7410:(e,l,a)=>{a.r(l),a.d(l,{default:()=>S});var t=a(9835),o=a(6970),i=a(1569),s=a(3682),n=a(499),r=a(9302);const u=(0,t._)("span",{class:"text-h6"},"Rentals",-1),d=(0,t.Uk)("Return"),m={class:"my-table-details"},c=(0,t._)("div",{class:"text-h6"},"Borrow Film",-1),p={__name:"BorrowedMoviesPage",setup(e){const l=[{name:"filmCopyId",required:!0,label:"ID",align:"left",field:"filmId",format:e=>`${e}`,sortable:!0},{name:"Film",align:"center",label:"Film Name",field:"name",sortable:!0},{name:"ReleaseDate",align:"center",label:"Release Date",field:"releaseDate",sortable:!0},{name:"Country",align:"center",label:"Country",field:"country",sortable:!0},{name:"Director",align:"center",label:"Director",field:"director",sortable:!0},{name:"action",label:"Return",align:"center",format:e=>`${e}`,sortable:!0}],a=(0,r.Z)(),p=(0,n.iH)([]),f=(0,s.t)(),g=f.loggedInUser.filmStudio.filmStudioId,h=f.loggedInUser.token,v={headers:{Authorization:`Bearer ${h}`}};function w(){i.api.get("/mystudio/rentals",v).then((e=>{e.data.forEach((e=>{i.api.get(`/films/${e.filmId}`,v).then((l=>{const a=l.data;delete a.filmCopies,a.filmCopyId=e.filmCopyId,p.value.push(a)}))}))})).catch((e=>alert("Could not get rentals list")))}w();const b=(0,n.iH)([]);function C(){i.api.get("/films").then((e=>{b.value=e.data})).catch((e=>alert("Could not get films list")))}C();const y=(0,n.iH)(!1),I=(0,n.iH)(""),_=(0,n.iH)(!1),q=(0,n.iH)(null);function k(){i.api.post(`/films/rent/?id=${q.value.filmId}&studioId=${g}`,{},v).then((e=>{i.api.get(`/films/${q.value.filmId}`,v).then((l=>{const a=l.data;delete a.filmCopies,a.filmCopyId=e.data.filmCopyId,p.value.push(a),_.value=!1}))})).catch((e=>{I.value=e.response.data.message,y.value=!0,setTimeout((()=>{_.value=!1,y.value=!1}),3e3)}))}function Q(e){i.api.post(`/films/return/?id=${e.filmId}&studioId=${g}`,{},v).then((l=>{a.dialog({title:"Film Returned",message:`${e.name} film returned successfully!`}),p.value=p.value.filter((l=>l.filmCopyId!=e.filmCopyId))}))}return(e,a)=>{const i=(0,t.up)("q-space"),s=(0,t.up)("q-btn"),n=(0,t.up)("q-td"),r=(0,t.up)("q-table"),f=(0,t.up)("q-card-section"),g=(0,t.up)("q-select"),h=(0,t.up)("q-banner"),v=(0,t.up)("q-card-actions"),w=(0,t.up)("q-card"),C=(0,t.up)("q-dialog"),W=(0,t.up)("q-page"),Z=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(W,{class:"q-ma-xl"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{title:"Rentals",rows:p.value,columns:l,"row-key":"name"},{top:(0,t.w5)((()=>[u,(0,t.Wm)(i),(0,t.Wm)(s,{color:"primary",outline:"",dense:"",class:"q-py-none",label:"Borrow film",onClick:a[0]||(a[0]=e=>_.value=!0)})])),"body-cell-action":(0,t.w5)((e=>[(0,t.Wm)(n,{props:e},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(s,{dense:"",push:"",class:"q-py-none",color:"info",onClick:l=>Q(e.row)},{default:(0,t.w5)((()=>[d])),_:2},1032,["onClick"])]),(0,t._)("div",m,(0,o.zw)(e.row.details),1)])),_:2},1032,["props"])])),_:1},8,["rows"]),(0,t.Wm)(C,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=e=>_.value=e),persistent:""},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{style:{"min-width":"350px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[c])),_:1}),(0,t.Wm)(f,{class:"q-pt-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{dense:"",outlined:"",modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e),options:b.value,label:"Films","option-value":"filmId","option-label":"name"},null,8,["modelValue","options"])])),_:1}),y.value?((0,t.wg)(),(0,t.j4)(h,{key:0,class:"text-white bg-red q-ma-md"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(I.value),1)])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(v,{align:"right",class:"text-primary"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(s,{flat:"",label:"Cancel"},null,512),[[Z]]),(0,t.Wm)(s,{flat:"",label:"Borrow",onClick:k})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}};var f=a(9885),g=a(1121),h=a(136),v=a(4455),w=a(7220),b=a(7743),C=a(4458),y=a(3190),I=a(9472),_=a(7128),q=a(1821),k=a(2146),Q=a(9984),W=a.n(Q);const Z=p,S=Z;W()(p,"components",{QPage:f.Z,QTable:g.Z,QSpace:h.Z,QBtn:v.Z,QTd:w.Z,QDialog:b.Z,QCard:C.Z,QCardSection:y.Z,QSelect:I.Z,QBanner:_.Z,QCardActions:q.Z}),W()(p,"directives",{ClosePopup:k.Z})}}]);